{
  "version": 3,
  "sources": ["../javascript/vanilla/cal_heatmap.js", "../javascript/vanilla/load_scripts_and_styles.js", "../javascript/vanilla/main.js"],
  "sourcesContent": ["export function createCalHeatmap(countsByDay, containerId = \"cal-heatmap\") {\r\n  // Check if a heatmap already exists in the container\r\n  if (document.querySelector(`#${containerId} > svg`)) {\r\n    console.log(\"Heatmap already exists. Skipping creation.\");\r\n    return; // Exit early if a heatmap is already present\r\n  }\r\n\r\n  // Import necessary dependencies (assume they are already loaded globally)\r\n  // Usage example\r\n  let filesToLoad = [\r\n    { src: \"https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js\", type: \"js\" },\r\n    { src: \"https://d3js.org/d3.v7.min.js\", type: \"js\" },\r\n    {\r\n      src: \"https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js\",\r\n      type: \"js\",\r\n    },\r\n    {\r\n      src: \"https://unpkg.com/cal-heatmap/dist/cal-heatmap.css\",\r\n      type: \"style\",\r\n    },\r\n    {\r\n      src: \"https://unpkg.com/cal-heatmap/dist/plugins/Legend.min.js\",\r\n      type: \"js\",\r\n    },\r\n    { src: \"https://unpkg.com/@popperjs/core@2\", type: \"js\" },\r\n    {\r\n      src: \"https://unpkg.com/cal-heatmap/dist/plugins/Tooltip.min.js\",\r\n      type: \"js\",\r\n    },\r\n    {\r\n      src: \"https://unpkg.com/cal-heatmap/dist/plugins/CalendarLabel.min.js\",\r\n      type: \"js\",\r\n    },\r\n  ];\r\n\r\n  function loadScriptsAndStyles(files) {\r\n    let promises = [];\r\n\r\n    function createPromise(file) {\r\n      return new Promise((resolve, reject) => {\r\n        let element;\r\n\r\n        if (file.type === \"js\") {\r\n          element = document.createElement(\"script\");\r\n          element.src = file.src;\r\n          element.onload = resolve;\r\n          element.onerror = reject;\r\n          document.head.appendChild(element);\r\n        } else if (file.type === \"style\") {\r\n          element = document.createElement(\"link\");\r\n          element.rel = \"stylesheet\";\r\n          element.href = file.src;\r\n          element.onload = resolve;\r\n          element.onerror = reject;\r\n          document.head.appendChild(element);\r\n        } else {\r\n          reject(new Error(`Unsupported file type: ${file.type}`));\r\n        }\r\n      });\r\n    }\r\n\r\n    files.forEach((file) => {\r\n      promises.push(createPromise(file));\r\n    });\r\n\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  // Usage example\r\n  loadScriptsAndStyles(filesToLoad)\r\n    .then(() => {\r\n      console.log(\"All files loaded successfully\");\r\n      // Call your function here\r\n      createHeatmap(countsByDay, containerId);\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error loading files:\", error);\r\n    });\r\n}\r\n\r\nfunction createHeatmap(countsByDay, containerId = \"cal-heatmap\") {\r\n  // Import necessary dependencies (assume they are already loaded globally)\r\n\r\n  // Clean up countsByDay data\r\n  function cleanUpCountsByDay(counts) {\r\n    return counts.map((item) => ({\r\n      date: dayjs(item.date).format(\"YYYY-MM-DD\"),\r\n      value: item.value,\r\n    }));\r\n  }\r\n\r\n  countsByDay = cleanUpCountsByDay(countsByDay);\r\n\r\n  // Determine screen size\r\n  function getScreenSize() {\r\n    const breakpoints = {\r\n      sm: 640,\r\n      md: 768,\r\n      lg: 1024,\r\n      xl: 1280,\r\n      \"2xl\": 1536,\r\n    };\r\n    const width = window.innerWidth;\r\n\r\n    if (width < breakpoints.sm) {\r\n      return \"small\";\r\n    } else if (width < breakpoints.md) {\r\n      return \"medium\";\r\n    } else if (width < breakpoints.lg) {\r\n      return \"large\";\r\n    } else {\r\n      return \"extralarge\";\r\n    }\r\n  }\r\n\r\n  let screenSize = getScreenSize();\r\n  let size = {\r\n    small: {\r\n      subtract: 3,\r\n      range: 4,\r\n    },\r\n    medium: {\r\n      subtract: 4,\r\n      range: 5,\r\n    },\r\n    large: {\r\n      subtract: 5,\r\n      range: 6,\r\n    },\r\n    extralarge: {\r\n      subtract: 6,\r\n      range: 7,\r\n    },\r\n  };\r\n  let currentSize = size[screenSize];\r\n\r\n  let start = dayjs().subtract(currentSize.subtract, \"month\");\r\n\r\n  // Define the upToTodayTemplate function\r\n  const upToTodayTemplate = function (DateHelper) {\r\n    return {\r\n      name: \"ghDayUpToToday\",\r\n      parent: \"ghDay\",\r\n\r\n      mapping: (startTimestamp, endTimestamp) => {\r\n        let weekNumber = 0;\r\n        let x = -1;\r\n\r\n        return DateHelper.intervals(\r\n          \"day\",\r\n          startTimestamp,\r\n          DateHelper.date(endTimestamp)\r\n        )\r\n          .map((ts) => {\r\n            const date = DateHelper.date(ts);\r\n\r\n            let today = new Date();\r\n            if (date > today) {\r\n              return null;\r\n            }\r\n\r\n            if (weekNumber !== date.week()) {\r\n              weekNumber = date.week();\r\n              x += 1;\r\n            }\r\n\r\n            return {\r\n              t: ts,\r\n              x,\r\n              y: date.day(),\r\n            };\r\n          })\r\n          .filter((n) => n !== null);\r\n      },\r\n    };\r\n  };\r\n\r\n  // Create CalHeatmap instance\r\n  const cal = new CalHeatmap();\r\n  cal.addTemplates(upToTodayTemplate);\r\n\r\n  // Function to paint the heatmap\r\n  function paintHeatmap(theme) {\r\n    cal.paint({\r\n      data: { source: countsByDay, x: \"date\", y: \"value\" },\r\n      range: currentSize.range,\r\n      date: { start: start, max: new Date() },\r\n      domain: {\r\n        type: \"month\",\r\n        gutter: 10,\r\n        dynamicDimension: true,\r\n        label: { position: \"top\" },\r\n      },\r\n      subDomain: {\r\n        type: \"ghDayUpToToday\",\r\n        radius: 3,\r\n        width: 15,\r\n        height: 15,\r\n        gutter: 4,\r\n      },\r\n      scale: {\r\n        color: {\r\n          type: \"linear\",\r\n          scheme: \"Greens\",\r\n          domain: [0, 3],\r\n        },\r\n      },\r\n      theme: theme,\r\n    });\r\n  }\r\n\r\n  // Initialize the heatmap\r\n  paintHeatmap(getLightOrDarkTheme());\r\n\r\n  // Function to get light or dark theme based on data-theme attribute\r\n  function getLightOrDarkTheme() {\r\n    let siteTheme = document.documentElement.getAttribute(\"data-theme\");\r\n    if (siteTheme == \"lightmode\") {\r\n      return \"light\";\r\n    } else {\r\n      return \"dark\";\r\n    }\r\n  }\r\n\r\n  // Mutation observer to detect changes in data-theme attribute\r\n  const observer = new MutationObserver((mutations) => {\r\n    mutations.forEach((mutation) => {\r\n      if (\r\n        mutation.type === \"attributes\" &&\r\n        mutation.attributeName === \"data-theme\"\r\n      ) {\r\n        // Update the data-theme attribute on the first svg child of the heatmap div\r\n        const svgElement = document.querySelector(`#${containerId} > svg`);\r\n        if (svgElement) {\r\n          svgElement.setAttribute(\"data-theme\", getLightOrDarkTheme());\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Observe changes in data-theme attribute\r\n  observer.observe(document.documentElement, {\r\n    attributes: true,\r\n  });\r\n\r\n  // Return the observer so it can be disconnected externally if needed\r\n  return observer;\r\n}\r\n", "export function loadScriptsAndStyles(files) {\r\n  // Promise array to track loading status\r\n  let promises = [];\r\n\r\n  // Helper function to create a promise for each file\r\n  function createPromise(file) {\r\n    return new Promise((resolve, reject) => {\r\n      let element;\r\n\r\n      if (file.endsWith(\".js\")) {\r\n        // Create script element for JavaScript file\r\n        element = document.createElement(\"script\");\r\n        element.src = file;\r\n        element.onload = resolve;\r\n        element.onerror = reject;\r\n        document.head.appendChild(element);\r\n      } else if (file.endsWith(\".css\")) {\r\n        // Create link element for CSS file\r\n        element = document.createElement(\"link\");\r\n        element.rel = \"stylesheet\";\r\n        element.href = file;\r\n        element.onload = resolve;\r\n        element.onerror = reject;\r\n        document.head.appendChild(element);\r\n      } else {\r\n        reject(new Error(`Unsupported file type: ${file}`));\r\n      }\r\n    });\r\n  }\r\n\r\n  // Create promises for each file and push them to the promises array\r\n  files.forEach((file) => {\r\n    promises.push(createPromise(file));\r\n  });\r\n\r\n  // Return a promise that resolves when all promises are resolved\r\n  return Promise.all(promises);\r\n}\r\n", "import { createCalHeatmap } from \"./cal_heatmap\";\r\nimport { loadScriptsAndStyles } from \"./load_scripts_and_styles\";\r\n\r\nwindow.initializeJS = function initializeApp(targetElement) {\r\n  console.log(\"initialize js\");\r\n  // Control zoom based on screen size\r\n  controlZoom();\r\n\r\n  // Set up PWA service worker\r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker\r\n      .register(\"/service-worker.js\", { type: \"classic\" })\r\n      .then(function (registration) {\r\n        console.log(\r\n          \"Service Worker registered with scope:\",\r\n          registration.scope\r\n        );\r\n      })\r\n      .catch(function (error) {\r\n        console.log(\"Service Worker registration failed:\", error);\r\n      });\r\n  }\r\n\r\n  refreshPageIfStale();\r\n};\r\n\r\n// controlZoom prevents zooming on mobile devices to improve user experience. Note that it is\r\n// not enforced by all browsers, so is not guaranteed to work on all of them. TODO: we may want to\r\n// remove that entirely as Brave/Chrome ignore these directives, and it may be globally useless if\r\n// all browsers ignore it.\r\nfunction controlZoom() {\r\n  const viewportMeta = document.querySelector('meta[name=\"viewport\"]');\r\n\r\n  function updateViewport() {\r\n    if (window.innerWidth < 1024) {\r\n      // Disable zooming on small screens\r\n      viewportMeta.setAttribute(\r\n        \"content\",\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\r\n      );\r\n    } else {\r\n      // Allow zooming on large screens\r\n      viewportMeta.setAttribute(\r\n        \"content\",\r\n        \"width=device-width, initial-scale=1.0\"\r\n      );\r\n    }\r\n  }\r\n\r\n  // Update on initial load\r\n  updateViewport();\r\n\r\n  // Update on window resize\r\n  window.addEventListener(\"resize\", updateViewport);\r\n}\r\n\r\nfunction refreshPageIfStale() {\r\n  document.addEventListener(\"visibilitychange\", function () {\r\n    if (document.visibilityState === \"visible\") {\r\n      // Check the time elapsed\r\n      const currentTime = new Date().getTime();\r\n      const lastVisitTime = localStorage.getItem(\"lastVisitTime\");\r\n      const timeElapsed = currentTime - lastVisitTime;\r\n\r\n      // Define a threshold (e.g., 10 minutes = 600000 ms)\r\n      if (timeElapsed > 600000) {\r\n        // 30 minutes\r\n        console.log(\"Refreshing data after inactivity\");\r\n        window.location.reload();\r\n      }\r\n    } else {\r\n      localStorage.setItem(\"lastVisitTime\", new Date().getTime());\r\n    }\r\n  });\r\n}\r\n\r\nwindow.createCalHeatmap = createCalHeatmap;\r\nwindow.loadScriptsAndStyles = loadScriptsAndStyles;\r\n"],
  "mappings": "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",
  "names": ["createCalHeatmap", "countsByDay", "containerId", "filesToLoad", "loadScriptsAndStyles", "files", "promises", "createPromise", "file", "resolve", "reject", "element", "createHeatmap", "error", "cleanUpCountsByDay", "counts", "item", "getScreenSize", "breakpoints", "width", "screenSize", "currentSize", "start", "upToTodayTemplate", "DateHelper", "startTimestamp", "endTimestamp", "weekNumber", "x", "ts", "date", "n", "cal", "paintHeatmap", "theme", "getLightOrDarkTheme", "observer", "mutations", "mutation", "svgElement", "loadScriptsAndStyles", "files", "promises", "createPromise", "file", "resolve", "reject", "element", "targetElement", "controlZoom", "registration", "error", "refreshPageIfStale", "viewportMeta", "updateViewport", "currentTime", "lastVisitTime", "createCalHeatmap", "loadScriptsAndStyles"]
}
